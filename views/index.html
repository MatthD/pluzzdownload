<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Téléchargement de video Pluzz.fr  - Accueil</title>

  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">

  <link rel="stylesheet" href="public/css/style.css">

</head>
<body background="#EE6E73">
  <div class="row">
    <h1 class="col s6 offset-s3">Télécharger une video Pluzz</h1>
  </div>
  <div class="row">
    <div class="card-panel red darken-2 col s6 offset-s3 white-text">{{ error }}</div>
  </div>

  <div class="row">
    <img src="/" alt="/" class="hide picture">
  </div>

  <div class="row">
    <div class="card-panel green col s6 offset-s3 white-text message"></div>
  </div>

  <div class="row progression hide">
      <div class="progressText col s6 offset-s3 center"></div>
      <div class="progress col s6 offset-s3">
        <div class="determinate"></div>
      </div>
  </div>

  <div class="row">
    <form  class="col s6 offset-s3" action="/" method="POST">
      <div class="row">
        <div class="input-field">
          <i class="material-icons prefix">input</i>
          <input id="lienPluzz" type="url" name="lienPluzz" class="validate" required>
          <label for="lienPluzz">Lien Pluzz</label>
        </div>
         <!-- options formats de conversion -->
        <div class="switch">
          <label>Veuillez choisir le format de sortie souhaitée :</label><br>
          <input class="with-gap"name="formatMP4" type="radio" id="formatMP4" checked="checked"/>
          <label for="formatMP4">.mp4</label>
          <input class="with-gap" name="formatMKV" type="radio" id="formatMKV"/>
          <label for="formatMKV">.mkv</label>
          <input class="with-gap" name="formatMP5" type="radio" id="formatMP5"/>
          <label for="formatMP5">.mp5</label>
        </div>
      </div>
      <div class="row bouttonTelechargement">
          <button class="btn waves-effect waves-light" type="submit" name="action">Télécharger
            <i class="material-icons right">send</i>
          </button>
        </div>
    </form>
  </div>
  
</body>

<!-- Jquery & Materialize framework -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.7/socket.io.min.js"></script>
<!-- Socketio pour mettre à jour le site sans rechargement -->
<script>
  var socket = io.connect('http://localhost:3000'),
      progression = $(".progression"),
      picture = $(".picture");
  socket.on('update', function (data) {
    console.log("Vous avez un message" , data);
    if(data.toast){
        Materialize.toast(data.toast, 4500, 'rounded');
    }
    if(data.message){
      $(".message").text(data.message);
    }
    if (data.progress){
      if(progression.hasClass("hide")){
        progression.removeClass("hide");
      }
      $(".determinate").css("width" , data.progress);
      $(".progressText").text(data.progress);
    }
    if(data.image){
      if(picture.hasClass("hide")){
        picture.removeClass("hide");
      }
      picture.attr("src" , data.picture);
    }
  });
</script>

</html>